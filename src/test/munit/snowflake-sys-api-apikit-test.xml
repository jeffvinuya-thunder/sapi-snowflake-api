<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd http://www.mulesoft.org/schema/mule/munit-tools http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd ">
    <munit:config name="snowflake-sys-api-apikit-test.xml" />
    <http:request-config name="HTTP_Request_Configuration" basePath="/api">
        <http:request-connection host="localhost" port="8081" />
    </http:request-config>
    <munit:test name="ping-success" description="Verifying functionality of [get:\ping:snowflake-sys-api-config-200-application\json]">
        <munit:enable-flow-sources>
            <munit:enable-flow-source value="snowflake-sys-api-main" />
            <munit:enable-flow-source value="get:\ping:snowflake-sys-api-config" />
        </munit:enable-flow-sources>
		<munit:execution>
            <http:request config-ref="HTTP_Request_Configuration" method="GET" path="/ping">
                <http:headers>#[{"Accept":"application/json"}]</http:headers>
            </http:request>
        </munit:execution>
        <munit:validation>
            <munit-tools:assert-that expression="#[attributes.statusCode]" is="#[MunitTools::equalTo(200)]" message="The HTTP Status code is not correct!" doc:name="Assert That Status Code is 200" />
			<munit-tools:assert doc:name="Assert payload" doc:id="95f23963-291b-4d13-b268-ad4725cfa026" message="The payload does not match">
				<munit-tools:that><![CDATA[#[%dw 2.0
import getpingsnowflakesysapiconfigtest::assert_expression_payload
---
assert_expression_payload::main({payload: payload, attributes: attributes, vars: vars})]]]></munit-tools:that>
			</munit-tools:assert>
        </munit:validation>
    </munit:test>
    <munit:test name="health-success" description="Verifying functionality of [get:\health:snowflake-sys-api-config-200-application\json]">
        <munit:enable-flow-sources>
            <munit:enable-flow-source value="snowflake-sys-api-main" />
            <munit:enable-flow-source value="get:\health:snowflake-sys-api-config" />
        </munit:enable-flow-sources>
        <munit:execution>
            <http:request config-ref="HTTP_Request_Configuration" method="GET" path="/health">
                <http:headers>#[{"Accept":"application/json"}]</http:headers>
            </http:request>
        </munit:execution>
        <munit:validation>
            <munit-tools:assert-that expression="#[attributes.statusCode]" is="#[MunitTools::equalTo(200)]" message="The HTTP Status code is not correct!" doc:name="Assert That Status Code is 200" />
			<munit-tools:assert doc:name="Assert payload" doc:id="631d9425-a672-406c-8e26-91801b4d33b2" message="The payload does not match" >
				<munit-tools:that ><![CDATA[#[%dw 2.0
import gethealthsnowflakesysapiconfigtest::assert_expression_payload
---
assert_expression_payload::main({payload: payload, attributes: attributes, vars: vars})]]]></munit-tools:that>
			</munit-tools:assert>
        </munit:validation>
    </munit:test>
    <munit:test name="mock-snowflake-connectivity-error" description="Verifying functionality of [get:\health:snowflake-sys-api-config-404-application\json]" expectedErrorType="SNOWFLAKE:CONNECTIVITY">
        <munit:enable-flow-sources>
            <munit:enable-flow-source value="snowflake-sys-api-main" />
            <munit:enable-flow-source value="get:\health:snowflake-sys-api-config" />
        </munit:enable-flow-sources>
		<munit:behavior>
			<munit-tools:mock-when doc:name="Mock when" doc:id="ef8e54a3-1aee-43bd-9727-6c983df97b57" processor="snowflake:select">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="82e77600-bc04-4dc9-867d-4dd12733d0c1" attributeName="doc:id" />
					<munit-tools:with-attribute whereValue="Snowflake_Config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="SNOWFLAKE:CONNECTIVITY" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution>
            <http:request config-ref="HTTP_Request_Configuration" method="GET" path="/health">
                <http:headers>#[{"Accept":"application/json"}]</http:headers>
                <http:response-validator>
                    <http:success-status-code-validator values="404" />
                </http:response-validator>
            </http:request>
        </munit:execution>
        <munit:validation>
			<munit-tools:assert doc:name="Assert error payload" doc:id="01f00c4b-d3b2-4288-a527-dff14a080f4d" message="The payload does not match" >
				<munit-tools:that ><![CDATA[#[%dw 2.0
import gethealthsnowflakesysapiconfigtest::assert_expression_snowflake_connectivity_error_payload
---
assert_expression_payload::main({payload: payload, attributes: attributes, vars: vars})]]]></munit-tools:that>
			</munit-tools:assert>
        </munit:validation>
    </munit:test>
	<munit:test name="mock-apikit-bad-request" description="Verifying functionality of [get:\ping:snowflake-sys-api-config-404-application\json]" expectedErrorType="APIKIT:BAD_REQUEST">
        <munit:enable-flow-sources>
            <munit:enable-flow-source value="snowflake-sys-api-main" />
            <munit:enable-flow-source value="get:\ping:snowflake-sys-api-config" />
        </munit:enable-flow-sources>
		<munit:behavior>
			<munit-tools:mock-when doc:name="Mock when" doc:id="5f322e98-42cf-44f7-a843-ae5b3226d94a" processor="apikit:router">
				<munit-tools:with-attributes>
					<munit-tools:with-attribute whereValue="snowflake-sys-api-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return>
					<munit-tools:error typeId="APIKIT:BAD_REQUEST" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution>
            <http:request config-ref="HTTP_Request_Configuration" method="GET" path="/ping">
                <http:headers>#[{"Accept":"application/json"}]</http:headers>
                <http:response-validator>
                    <http:success-status-code-validator values="404" />
                </http:response-validator>
            </http:request>
        </munit:execution>
        <munit:validation>
			<munit-tools:assert doc:name="Assert error payload" doc:id="a02609da-503a-4983-b53a-5429e757ca28" message="The payload does not match">
				<munit-tools:that><![CDATA[#[%dw 2.0
import gethealthsnowflakesysapiconfigtest::assert_bad_request_expression_error_payload
---
assert_expression_payload::main({payload: payload, attributes: attributes, vars: vars})]]]></munit-tools:that>
			</munit-tools:assert>
        </munit:validation>
    </munit:test>
	<munit:test name="mock-apikit-method-not-allowed" doc:id="9407bde0-7063-4044-9d7e-29d74cf745ee" description="Verifying functionality of [get:\ping:snowflake-sys-api-config-404-application\json]" expectedErrorType="APIKIT:METHOD_NOT_ALLOWED">
		
		<munit:enable-flow-sources>
			
			
			<munit:enable-flow-source value="snowflake-sys-api-main" />
			<munit:enable-flow-source value="get:\ping:snowflake-sys-api-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when" doc:id="027a43e7-2c4a-406a-beba-938ea9c9478f" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="snowflake-sys-api-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="APIKIT:METHOD_NOT_ALLOWED" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request doc:name="Request" doc:id="8728692f-473e-4573-baad-4607eda2f668" config-ref="HTTP_Request_Configuration" path="/ping" >
				<http:headers ><![CDATA[#[{"Accept":"application/json"}]]]></http:headers>
				<http:response-validator >
					<http:success-status-code-validator values="404" />
				</http:response-validator>
			</http:request>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert doc:name="Assert error payload" doc:id="b3cb88f4-f370-4dea-8c4b-3440e2108c2e" message="The payload does not match" >
				<munit-tools:that ><![CDATA[#[%dw 2.0
import gethealthsnowflakesysapiconfigtest::assert_expression_method_not_allowed_error_payload
---
assert_expression_payload::main({payload: payload, attributes: attributes, vars: vars})]]]></munit-tools:that>
			</munit-tools:assert>
		</munit:validation>
	</munit:test>
	<munit:test name="mock-apikit-not-acceptable" doc:id="2d6233e4-1098-4119-bdfc-ad4ddfd8ae4d" description="Verifying functionality of [get:\ping:snowflake-sys-api-config-404-application\json]" expectedErrorType="APIKIT:NOT_ACCEPTABLE">
		
		<munit:enable-flow-sources>
			
			
			<munit:enable-flow-source value="snowflake-sys-api-main" />
			<munit:enable-flow-source value="get:\ping:snowflake-sys-api-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when" doc:id="e7d0491b-139f-4cff-9d94-f7f8d8eb4ee7" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="snowflake-sys-api-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="APIKIT:NOT_ACCEPTABLE" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request doc:name="Request" doc:id="332f8d89-7e7e-4d90-a6a7-94f34a2ca8b8" config-ref="HTTP_Request_Configuration" path="/ping" >
				<http:headers ><![CDATA[#[{"Accept":"application/json"}]]]></http:headers>
				<http:response-validator >
					<http:success-status-code-validator values="404" />
				</http:response-validator>
			</http:request>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert doc:name="Assert error payload" doc:id="2393c5fc-0f05-473e-84ef-f1775a9c009d" message="The payload does not match" >
				<munit-tools:that ><![CDATA[#[%dw 2.0
import gethealthsnowflakesysapiconfigtest::assert_expression_not_acceptable_error_payload
---
assert_expression_payload::main({payload: payload, attributes: attributes, vars: vars})]]]></munit-tools:that>
			</munit-tools:assert>
		</munit:validation>
	</munit:test>
	<munit:test name="mock-apikit-unsupported-media-type" doc:id="4690be8c-a80b-4904-a83a-b5135164b05f" description="Verifying functionality of [get:\ping:snowflake-sys-api-config-404-application\json]" expectedErrorType="APIKIT:UNSUPPORTED_MEDIA_TYPE">
		
		<munit:enable-flow-sources>
			
			
			<munit:enable-flow-source value="snowflake-sys-api-main" />
			<munit:enable-flow-source value="get:\ping:snowflake-sys-api-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when" doc:id="4bb797fb-a3c1-42ef-8c02-b5103fad7281" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="snowflake-sys-api-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="APIKIT:UNSUPPORTED_MEDIA_TYPE" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request doc:name="Request" doc:id="8d60b4fd-3f6a-4b9d-ba06-a4539d9f968d" config-ref="HTTP_Request_Configuration" path="/ping" >
				<http:headers ><![CDATA[#[{"Accept":"application/json"}]]]></http:headers>
				<http:response-validator >
					<http:success-status-code-validator values="404" />
				</http:response-validator>
			</http:request>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert doc:name="Assert error payload" doc:id="321e242e-ebce-4918-88f3-c0de88ac2338" message="The payload does not match" >
				<munit-tools:that ><![CDATA[#[%dw 2.0
import gethealthsnowflakesysapiconfigtest::assert_expression_unsupported_media_error_payload
---
assert_expression_payload::main({payload: payload, attributes: attributes, vars: vars})]]]></munit-tools:that>
			</munit-tools:assert>
		</munit:validation>
	</munit:test>
	<munit:test name="mock-apikit-not-implemented" doc:id="8e3b54db-0fea-4afb-9a1c-246f88f3cddd" description="Verifying functionality of [get:\ping:snowflake-sys-api-config-404-application\json]" expectedErrorType="APIKIT:NOT_IMPLEMENTED">
		
		<munit:enable-flow-sources>
			
			
			<munit:enable-flow-source value="snowflake-sys-api-main" />
			<munit:enable-flow-source value="get:\ping:snowflake-sys-api-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when" doc:id="785cd39b-d96e-4719-8caf-f3dc018a9d31" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="snowflake-sys-api-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="APIKIT:NOT_IMPLEMENTED" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request doc:name="Request" doc:id="6994475c-fa53-4bb6-8b6b-21002c09df7c" config-ref="HTTP_Request_Configuration" path="/ping" >
				<http:headers ><![CDATA[#[{"Accept":"application/json"}]]]></http:headers>
				<http:response-validator >
					<http:success-status-code-validator values="404" />
				</http:response-validator>
			</http:request>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert doc:name="Assert error payload" doc:id="e256e446-9dab-4fb5-8a77-ba8f2eb04fb8" message="The payload does not match" >
				<munit-tools:that ><![CDATA[#[%dw 2.0
import gethealthsnowflakesysapiconfigtest::assert_expression_not_implemented_error_payload
---
assert_expression_payload::main({payload: payload, attributes: attributes, vars: vars})]]]></munit-tools:that>
			</munit-tools:assert>
		</munit:validation>
	</munit:test>
	<munit:test name="mock-apikit-console-not-found" doc:id="41d7daa7-0243-4ae7-b525-8bd9dba93062" description="Verifying functionality of [get:\ping:snowflake-sys-api-config-404-application\json]" expectedErrorType="APIKIT:NOT_FOUND">
		
		<munit:enable-flow-sources>
			
			
			<munit:enable-flow-source value="snowflake-sys-api-main" />
			<munit:enable-flow-source value="get:\ping:snowflake-sys-api-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when" doc:id="b76337d3-89f4-4e2f-84db-c726c7adbc1f" processor="apikit:console" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="snowflake-sys-api-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="APIKIT:NOT_FOUND" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request doc:name="Request" doc:id="17b6df0a-cb71-4b68-890c-f1b31ab36d68" config-ref="HTTP_Request_Configuration" path="/ping" >
				<http:headers ><![CDATA[#[{"Accept":"application/json"}]]]></http:headers>
				<http:response-validator >
					<http:success-status-code-validator values="404" />
				</http:response-validator>
			</http:request>
		</munit:execution>
		<munit:validation >
			<munit-tools:assert doc:name="Assert error payload" doc:id="c82eebd0-9724-483b-999d-76ba934be7d2" message="The payload does not match" >
				<munit-tools:that ><![CDATA[#[%dw 2.0
import gethealthsnowflakesysapiconfigtest::assert_expression_not_found_error_payload
---
assert_expression_payload::main({payload: payload, attributes: attributes, vars: vars})]]]></munit-tools:that>
			</munit-tools:assert>
		</munit:validation>
	</munit:test>
	<munit:test name="mock-apikit-not-found" description="Verifying functionality of [get:\ping:snowflake-sys-api-config-500-application\json]" expectedErrorType="APIKIT:NOT_FOUND">
        <munit:enable-flow-sources>
            <munit:enable-flow-source value="snowflake-sys-api-main" />
            <munit:enable-flow-source value="get:\ping:snowflake-sys-api-config" />
        </munit:enable-flow-sources>
        <munit:behavior>
			<munit-tools:mock-when doc:name="Mock when" doc:id="8479a167-5dff-4311-b3c5-11e7fc2d428c" processor="apikit:router">
				<munit-tools:with-attributes>
					<munit-tools:with-attribute whereValue="snowflake-sys-api-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return>
					<munit-tools:error typeId="APIKIT:NOT_FOUND" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution>
            <http:request config-ref="HTTP_Request_Configuration" method="GET" path="/ping">
                <http:headers>#[{"Accept":"application/json"}]</http:headers>
                <http:response-validator>
                    <http:success-status-code-validator values="500" />
                </http:response-validator>
            </http:request>
        </munit:execution>
        <munit:validation>
			<munit-tools:assert doc:name="Assert error payload" doc:id="8fb12a13-ff08-4f24-918b-b83a55e79bfa" message="The payload does not match" >
				<munit-tools:that ><![CDATA[#[%dw 2.0
import gethealthsnowflakesysapiconfigtest::assert_expression_not_found_error_payload
---
assert_expression_payload::main({payload: payload, attributes: attributes, vars: vars})]]]></munit-tools:that>
			</munit-tools:assert>
        </munit:validation>
    </munit:test>
</mule>
